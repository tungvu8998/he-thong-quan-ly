
=======
Hệ Thống Quản Lý Ví Điểm Thưởng
1. Giới Thiệu Dự Án
Dự án Hệ Thống Đăng Nhập, Đăng Ký Tài Khoản và Quản Lý Ví Điểm Thưởng là một ứng dụng console đơn giản được phát triển bằng C++. Hệ thống này tập trung vào việc quản lý thông tin người dùng, xác thực đăng nhập, và đặc biệt là quản lý các giao dịch chuyển điểm giữa các ví điểm thưởng. Dữ liệu được lưu trữ dưới dạng các tệp tin văn bản (.txt) để mô phỏng cơ sở dữ liệu.

Các chức năng chính bao gồm: đăng ký tài khoản mới, đăng nhập an toàn (với chức năng đổi mật khẩu bắt buộc cho mật khẩu tự động sinh), quản lý ví điểm thưởng (bao gồm ví tổng), thực hiện giao dịch chuyển điểm giữa các ví, và theo dõi lịch sử giao dịch. Hệ thống cũng áp dụng cơ chế xác thực hai bước (OTP) cho các thao tác quan trọng và phân quyền người dùng thành người dùng thông thường và người dùng quản lý (admin).

2. Thành Viên Dự Án
Dự án được thực hiện bởi nhóm gồm 3 thành viên:

[Vũ Hữu Tùng-K24DTCN634] (Nhóm Trưởng)

Công việc đảm nhận: Trưởng nhóm dự án, phụ trách code chính, hợp nhất code (Git Merge),dựng UML ,viết tài liệu README, code phần quản lý người dùng (lớp User và các chức năng liên quan như đăng ký, đăng nhập, cập nhật thông tin).

[Nguyễn Trọng Đức - K24DTCN587]

Công việc đảm nhận: Triển khai phần phân chia người dùng và chức năng (phần B), bao gồm các quyền hạn và chức năng riêng biệt cho người dùng thông thường và người dùng quản lý, cũng như các chức năng quản lý ví điểm thưởng (lớp Wallet và các chức năng giao dịch, lịch sử).

[Bùi Thị Thanh Nhạn - K24DTCN615]

Công việc đảm nhận: Triển khai phần quản lý hoạt động ví (phần C), bao gồm cơ chế ví tổng, giao dịch chuyển điểm với tính nguyên tử và xác thực OTP, cũng như báo cáo lịch sử giao dịch.

3. Phân Tích & Đặc Tả Chức Năng
A. Các Chức Năng Cơ Bản
Tạo Mới Tài Khoản Khi Đăng Ký:

Cho phép người dùng nhập dữ liệu cá nhân (tên đăng nhập, mật khẩu, họ tên, email, số điện thoại) để tạo tài khoản mới.

Có khả năng nhân viên quản lý tạo tài khoản hộ người dùng.

Cấu trúc dữ liệu tài khoản: Lớp User gồm username, hashedPassword, fullName, email, phoneNumber, userId (ID duy nhất), registrationDate, isAutoGeneratedPassword (kiểm tra mật khẩu tự sinh), userType ("normal" hoặc "admin").

Lưu Trữ Dữ Liệu:

Giải pháp: Lưu trữ dữ liệu mỗi người dùng vào một tập tin riêng (tên file là username.txt) trong thư mục data/users/. Mỗi ví điểm thưởng cũng có tập tin riêng (walletId.txt) trong data/wallets/.

Lý do: Dễ dàng quản lý, truy cập, cập nhật và giảm thiểu xung đột khi nhiều thao tác diễn ra đồng thời.

Lưu mật khẩu: Sử dụng hàm băm (hash function) để chuyển đổi mật khẩu thuần thành mật khẩu đã băm (hashedPassword) trước khi lưu. KHÔNG lưu mật khẩu thuần văn bản.

Sao lưu (Backup): Đề xuất sao lưu thư mục data/ định kỳ (thủ công hoặc tự động) bằng cách nén thành file zip/tar.gz và lưu trữ ở nơi khác (ổ đĩa riêng, đám mây). Quy trình phục hồi là giải nén file backup và đè dữ liệu vào vị trí gốc.

Quản Lý Đăng Nhập:

Sinh mật khẩu tự động: Hệ thống có thể tự động sinh mật khẩu ngẫu nhiên cho người dùng trong trường hợp người quản lý tạo tài khoản hộ. Mật khẩu này sẽ được đánh dấu là "tự sinh" (isAutoGeneratedPassword = true).

Thay đổi mật khẩu: Người dùng có thể tự thay đổi mật khẩu của mình. Hệ thống yêu cầu nhập mật khẩu cũ để xác minh. Với mật khẩu tự sinh, người dùng buộc phải thay đổi mật khẩu trong lần đăng nhập đầu tiên.

OTP (One Time Password): Được sử dụng để xác thực các hoạt động thay đổi thông tin quan trọng hoặc giao dịch chuyển điểm. OTP có thời gian hiệu lực ngắn và chỉ sử dụng một lần. Trong đồ án, OTP được sinh ra và thông báo (giả lập in ra console) để người dùng nhập vào xác nhận.

Đăng nhập: Người dùng nhập tên đăng nhập và mật khẩu. Hệ thống tìm kiếm trong dữ liệu lưu trữ để xác định tính hợp lệ. Nếu hợp lệ, cho phép người dùng truy cập và điều hướng đến menu chức năng phù hợp.

B. Phân Chia Người Dùng và Chức Năng
Người Dùng Thông Thường (userType = "normal"):

Chỉ được phép truy xuất thông tin cá nhân của chính mình.

Được phép điều chỉnh các trường: fullName, email, phoneNumber, password.

Quy trình cập nhật: Sau khi nhập thông tin mới, hệ thống gửi mã OTP đến chủ tài khoản để xác nhận thay đổi. Nếu OTP hợp lệ, thông tin sẽ được cập nhật.

KHÔNG được phép thay đổi tên tài khoản đăng nhập (username).

Người Dùng Quản Lý (userType = "admin"):

Ngoài các chức năng của người dùng thông thường (đối với chính họ), người quản lý có thể:

Theo dõi danh sách tất cả tài khoản: Hiển thị thông tin cơ bản của tất cả người dùng.

Tạo thêm tài khoản mới: Nhập thông tin để tạo tài khoản mới cho người khác, có thể chọn loại tài khoản ("normal"/"admin") và cho phép sinh mật khẩu tự động.

Điều chỉnh thông tin của tài khoản khác: Khi có yêu cầu từ chủ tài khoản. Quy trình tương tự như người dùng tự cập nhật (gửi OTP đến chủ tài khoản để xác nhận).

KHÔNG được phép thay đổi tên tài khoản đăng nhập (username) của bất kỳ tài khoản nào.

C. Quản Lý Hoạt Động Ví
Ví Điểm Thưởng: Mỗi người dùng có một ví điểm thưởng với mã số định danh duy nhất (walletId) và số dư (balance).

Ví Tổng (MASTER_WALLET): Một ví đặc biệt, là nguồn duy nhất sinh ra tổng số điểm lưu chuyển trong hệ thống.

Giao Dịch Chuyển Điểm:

Quy trình Atomic: Giao dịch chuyển điểm từ ví A sang ví B là một thao tác nguyên tử. Nếu bất kỳ tác vụ nào trong giao dịch thất bại (ví dụ: thiếu số dư, lỗi lưu file), toàn bộ giao dịch sẽ bị hủy bỏ và số dư của cả hai ví A, B được phục hồi về trạng thái trước giao dịch.

Xác nhận OTP: Trước khi thực hiện giao dịch chuyển điểm, hệ thống yêu cầu người gửi nhập mã OTP để xác nhận thao tác.

Lịch Sử Giao Dịch: Mỗi giao dịch (thành công hoặc thất bại) đều được ghi lại vào file transactions.log với đầy đủ thông tin (ID giao dịch, ví gửi, ví nhận, số điểm, thời gian, trạng thái, mô tả).

Báo Cáo: Hệ thống cho phép người dùng theo dõi số dư ví hiện tại và xem lịch sử các giao dịch liên quan đến ví của mình (kèm trạng thái thực hiện).

4. Cách Tải Chương Trình, Biên Dịch và Các Tệp Tin
4.1. Tải Chương Trình
Mã nguồn đầy đủ của dự án hiện có trong kho chứa này. Bạn có thể clone (tải xuống) toàn bộ kho chứa về máy tính của mình.

4.2. Cấu Trúc Tệp Tin
/reward_system_project
├── main.cpp               // Giao diện người dùng chính, điều phối luồng chương trình
├── user.h                 // Định nghĩa lớp User
├── user.cpp               // Triển khai các hàm thành viên của lớp User
├── wallet.h               // Định nghĩa lớp Wallet và struct Transaction
├── wallet.cpp             // Triển khai các hàm thành viên của lớp Wallet
├── otp.h                  // Định nghĩa lớp OTPManager
├── otp.cpp                // Triển khai các hàm của OTPManager
├── utils.h                // Các hàm tiện ích chung
├── utils.cpp              // Triển khai các hàm tiện ích chung
└── data/                  // Thư mục chứa các tập tin dữ liệu
    ├── users/             // Thư mục chứa tập tin dữ liệu của từng người dùng (username.txt)
    ├── wallets/           // Thư mục chứa tập tin dữ liệu của từng ví (walletId.txt)
    ├── user_index.txt     // Tập tin index chứa danh sách usernames
    ├── wallet_index.txt   // Tập tin index chứa danh sách wallet IDs
    └── transactions.log   // Tập tin ghi lại lịch sử tất cả các giao dịch

4.3. Các Thư Viện Kèm Theo
Dự án sử dụng các thư viện chuẩn của C++ và C (không cần các thư viện bên ngoài đặc biệt):

<iostream>: Nhập/xuất console

<string>: Xử lý chuỗi

<vector>: Sử dụng vector động

<sstream>: Thao tác với chuỗi luồng

<fstream>: Đọc/ghi file

<ctime>: Thao tác thời gian

<random>: Sinh số ngẫu nhiên

<iomanip>: Định dạng đầu ra (ví dụ: số thực)

<functional>: Cho std::hash

<algorithm>: Các thuật toán chung

<cctype>: Kiểm tra ký tự

<memory>: Cho std::unique_ptr

<stdexcept>: Cho các ngoại lệ chuẩn

<string.h>: Cho strerror

<cstdio>: Cho sscanf

<direct.h> (Windows): Cho _mkdir

<sys/stat.h>: Cho stat, _stat, mkdir

<errno.h>: Cho errno

<io.h> (Windows): Cho _stat

4.4. Biên Dịch Chương Trình

Mở Dev-C++:

Vào File > New > Project...

Chọn Console Application, C++ Project. Đặt tên project (ví dụ: RewardSystem).

Lưu project vào thư mục gốc của mã nguồn (nơi có main.cpp).

Thêm tất cả các file vào Project:

Trong cửa sổ Project Tree bên trái, click chuột phải vào tên project.

Chọn Add to Project... (hoặc Add Files...).

Chọn tất cả các file .cpp và .h trong thư mục gốc dự án (main.cpp, user.h, user.cpp, ...).

Cấu hình Compiler Options:

Vào menu Tools > Compiler Options...

Trong tab Settings, tìm mục "Add the following commands when calling the compiler".

Đảm bảo KHÔNG có các cờ -std=c++17 hay -lstdc++fs.

Bạn có thể thêm cờ -std=c++11 hoặc -std=c++14 nếu trình biên dịch của bạn hỗ trợ.

Nhấn OK.

Biên dịch:

Nhấn F9 để biên dịch Project.

Nếu không có lỗi, Dev-C++ sẽ tạo file thực thi.

5. Cách Chạy Chương Trình & Thao Tác Thực Hiện
5.1. Chuẩn bị Thư Mục Dữ Liệu
Trước khi chạy chương trình lần đầu tiên, bạn phải tự tay tạo các thư mục sau trong thư mục gốc của project (nơi chứa file main.exe sau khi biên dịch):

/reward_system_project
└── data/
    ├── users/
    └── wallets/

5.2. Chuẩn bị Dữ Liệu Mẫu (Tùy Chọn)
Để có sẵn dữ liệu để kiểm tra, bạn có thể tạo các file dữ liệu mẫu. Nếu không, bạn có thể đăng ký tài khoản mới trực tiếp từ chương trình.

Các file cần tạo thủ công trong thư mục data/:

data/users/user1.txt: Thông tin người dùng thông thường.

data/users/admin1.txt: Thông tin người dùng quản lý (admin).

data/wallets/[ID_VI_USER1].txt: Thông tin ví của user1. (Thay [ID_VI_USER1] bằng ID ví thực tế từ file user1.txt).

data/wallets/[ID_VI_ADMIN1].txt: Thông tin ví của admin1. (Thay [ID_VI_ADMIN1] bằng ID ví thực tế từ file admin1.txt).

data/wallets/MASTER_WALLET.txt: Thôgn tin ví tổng.

data/user_index.txt: Chứa danh sách username (VD: user1\nadmin1).

data/wallet_index.txt: Chứa danh sách wallet ID (VD: [ID_VI_USER1]\n[ID_VI_ADMIN1]\nMASTER_WALLET).

data/transactions.log: Chứa lịch sử giao dịch.

(Chi tiết nội dung các file này đã được cung cấp trong các lần trao đổi trước)

5.3. Chạy Chương Trình
Trong Dev-C++: Nhấn F10 (hoặc Execute > Run) để chạy chương trình. Một cửa sổ console sẽ hiện ra.

5.4. Các Thao Tác Cơ Bản
Khi chương trình khởi chạy, bạn sẽ thấy menu chính:

--- He thong quan ly diem thuong ---
1. Dang ky
2. Dang nhap
0. Thoat
Nhap lua chon cua ban:

Đăng ký tài khoản mới:

Nhập 1 và làm theo hướng dẫn. Sau khi đăng ký thành công, tài khoản và ví sẽ được tạo.

Đăng nhập (Người dùng thông thường):

Nhập 2.

Nhập Username: user1

Nhập Password: password123

Bạn sẽ được đưa đến "Menu người dùng thông thường" với các chức năng như xem thông tin, cập nhật, đổi mật khẩu, xem ví, chuyển điểm, xem lịch sử.

Đăng nhập (Người dùng quản lý - Admin):

Nhập 2.

Nhập Username: admin1

Nhập Password: adminpass

Bạn sẽ được đưa đến "Menu người dùng quản lý" với các chức năng thêm:

4. Theo doi danh sach tat ca tai khoan: Xem danh sách user trong hệ thống.

5. Tao tai khoan moi: Tạo tài khoản cho người khác, có thể đặt userType là admin.

6. Dieu chinh thong tin tai khoan khac: Cập nhật thông tin user bất kỳ (cần OTP xác nhận từ chủ tài khoản).

7. Xem tat ca lich su giao dich: Xem tất cả giao dịch trong hệ thống.

Chuyển điểm:

Trong menu người dùng, chọn chức năng chuyển điểm.

Cần nhập ID ví người nhận và số điểm.

Hệ thống sẽ yêu cầu nhập OTP (mã OTP sẽ in ra console) để xác nhận giao dịch.

OTP: Khi thực hiện các thao tác quan trọng (cập nhật thông tin, chuyển điểm), hệ thống sẽ sinh OTP. Hãy chú ý console để lấy mã OTP và nhập vào.
>>>>>>> develop
